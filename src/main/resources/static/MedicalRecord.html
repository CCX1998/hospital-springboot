<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
		<title>Bootstrap 101 Template</title>

		<link rel="stylesheet" type="text/css" href="./lib/private/public.css" />
		<link href="./lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
		<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
		<script src="./lib/bootstrap/js/jquery-3.5.1.min.js"></script>

		<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
		<script src="./lib/bootstrap/js/bootstrap.min.js"></script>

		<!-- 消息提示插件 -->
		<link rel="stylesheet" href="./lib/toastr/toastr.min.css">
		<style>
			#one-all>div:first-child div:hover {
			color: #8fa9aa;
		}

		.submitbtn:hover {
			color: #8fa9aa;
		}
	</style>
	</head>

	<body id="bodyContainer">
		<div id="one-all" style="position: relative;
			padding: 10px;
			border-top: none;
			margin-right: 5px;">
			<div class="highlight border-line">
				<div class="container-fluid">
					<div class="row">
						<div class="col-sm-4"></div>
						<div class="col-sm-1 text-primary">
							<span class="glyphicon glyphicon-floppy-save" style="font-size: small;"></span>暂存
						</div>
						<div class="col-sm-2"></div>
						<div class="col-sm-1 text-primary">
							<span class="glyphicon glyphicon-upload submitbtn" style="font-size: small;"></span>提交
						</div>
						<div class="col-sm-4"></div>
					</div>
				</div>
			</div>
			<div class="container-fluid">
				<div class="row">
					<div class="col-sm-2 text-primary highlight text-center" style="background-color: #eef6fe; line-height: 30px;">
						病历内容:
					</div>
				</div>
			</div>

			<div style="margin-right: 20px;">
				<form class="form-horizontal" id="medicalrecord">
					<div class="form-group">
						<label for="inputEmail3" class="col-sm-1 control-label">主诉</label>
						<div class="col-sm-11">
							<input type="text" class="form-control" id="inputEmail3" placeholder="主诉" v-model="medicalrecord.symptom" />
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-1 control-label">现病史</label>
						<div class="col-sm-11">
							<textarea class="form-control" rows="3" placeholder="现病史" v-model="medicalrecord.nowHistory"></textarea>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-1 control-label">现病治疗情况</label>
						<div class="col-sm-11">
							<textarea class="form-control" rows="3" placeholder="现病治疗情况" v-model="medicalrecord.treatment"></textarea>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-1 control-label">既往史</label>
						<div class="col-sm-11">
							<textarea class="form-control" rows="3" placeholder="既往史" v-model="medicalrecord.anamnesis"></textarea>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-1 control-label">过敏史</label>
						<div class="col-sm-11">
							<textarea class="form-control" rows="3" placeholder="过敏史" v-model="medicalrecord.allergyhis"></textarea>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-1 control-label">体格检查</label>
						<div class="col-sm-11">
							<textarea class="form-control" rows="2" placeholder="体格检查" v-model="medicalrecord.checkup"></textarea>
						</div>
					</div>
					<div class="container-fluid">
						<div class="row">
							<div class="col-sm-2 text-primary highlight text-center" style="background-color: #eef6fe;
								line-height: 30px;
								margin-bottom: 5px;">
								评估/诊断:
							</div>
						</div>
					</div>

					<input type="hidden" name="" id="diagnoseType" v-model="diagnoseType" />

					<div class="shadow padding-medium" style="margin-bottom: 5px;">
						<div class="container-fluid">
							<div class="row">
								<div class="col-sm-2 text-info" style="font-size: medium;">
									西医诊断
								</div>
								<div class="col-sm-8"></div>
								<div class="col-sm-2">
									<a href="">删除</a>
									<span>/</span>
									<a v-on:click="setDiagnoseType(1)">更改</a>
								</div>
							</div>
						</div>
						<div class="container-fluid">
							<table id="xiyitable" class="table table-hover text-center">
								<tr style="font-weight: 600;">
									<td class="col-sm-1">
										<div class="checkbox">
											<input type="checkbox" />
										</div>
									</td>
									<td class="col-sm-1">ICD编码</td>
									<td class="col-sm-3">名称</td>
									<td class="col-sm-5"></td>
									<td class="col-sm-2">发病时间</td>
								</tr>
								<tr>
									<td class="col-sm-1">
										<div class="checkbox">
											<input type="checkbox" />
										</div>
									</td>
									<td class="col-sm-1">{{WesternDiagnose.icd}}</td>
									<td class="col-sm-3">{{WesternDiagnose.diseaseName}}</td>
									<td class="col-sm-5"></td>
									<td class="col-sm-2">{{WesternDiagnose.diagnoseDate}}</td>
								</tr>
							</table>
						</div>
					</div>
					<div class="shadow padding-medium">
						<div class="container-fluid">
							<div class="row">
								<div class="col-sm-2 text-info" style="font-size: medium;">
									中医诊断
								</div>
								<div class="col-sm-8"></div>
								<div class="col-sm-2">
									<a href="">删除</a>
									<span>/</span>
									<a v-on:click="setDiagnoseType(2)">更改</a>
								</div>
							</div>
						</div>
						<div class="container-fluid">
							<table class="table table-hover text-center" id="zhongyitable">
								<tr style="font-weight: 600;">
									<td class="col-sm-1">
										<div class="checkbox">
											<input type="checkbox" />
										</div>
									</td>
									<td class="col-sm-1">ICD编码</td>
									<td class="col-sm-3">名称</td>
									<td class="col-sm-5"></td>
									<td class="col-sm-2">发病时间</td>
								</tr>
								<tr>
									<td class="col-sm-1">
										<div class="checkbox">
											<input type="checkbox" />
										</div>
									</td>
									<td class="col-sm-1">{{ChineseDiagnose.icd}}</td>
									<td class="col-sm-3">{{ChineseDiagnose.diseaseName}}</td>
									<td class="col-sm-5"></td>
									<td class="col-sm-2">{{ChineseDiagnose.diagnoseDate}}</td>
								</tr>
							</table>
						</div>
					</div>
					<div class="form-group" style="margin-top:10px">
						<label class="col-sm-1 control-label">检查建议</label>
						<div class="col-sm-11">
							<textarea class="form-control" rows="2" placeholder="检察建议" v-model="medicalrecord.checkSugg"></textarea>
						</div>
					</div>
					<div class="form-group" style="margin-top: 5px;">
						<label class="col-sm-1 control-label">注意事项</label>
						<div class="col-sm-11">
							<textarea class="form-control" rows="2" placeholder="注意事项" v-model="medicalrecord.attention"></textarea>
						</div>
					</div>
					<div class="row" style="margin-left: 10px;">
						<div id="smallsubmit" v-on:click="submit" class="col-sm-1 text-primary submitbtn">
							<span class="glyphicon glyphicon-upload" style="font-size: small;"></span>提交
						</div>
					</div>
				</form>
			</div>
		</div>
		<!-- 弹出疾病选择框 -->
		<div id="diease" class="center-center-down shadow border-line" style="width: 800px; height: 500px; background-color:#FFFFFF;display:
		none;padding: 30px 20px 0px;">
			<form class="form-inline" style="width: 70%; position: relative; left:
			50%;transform: translate(-50%,0);margin-bottom: 20px;">
				<div class="form-group">
					<input type="text" class="form-control" id="inputPassword2" placeholder="疾病种类">
				</div>
				<div class="form-group">

					<input type="text" class="form-control" id="inputPassword3" placeholder="疾病名称">

				</div>
				<button type="submit" class="btn btn-default"><span class="glyphicon
					glyphicon-search"></span></button>
			</form>
			<div class="container-fluid" id="disease-pop">
				<table class="table table-hover text-center" id="diseasetable">
					<input type="hidden" name="" id="selectDiseaseId" v-model="selectDiseaseId" />
					<tr style="font-weight: 600;">
						<td class="col-sm-2">ICD编码</td>
						<td class="col-sm-2">名称</td>
						<td class="col-sm-1">类型</td>
						<td class="col-sm-4"></td>
						<td class="col-sm-1">操作</td>
					</tr>
					<tr id="disease-page" v-for="(d) in diseases" style="font-size: 14;">
						<td class="col-sm-2">{{d.icd}}</td>
						<td class="col-sm-2">{{d.name}}</td>
						<td class="col-sm-1">{{d.type}}</td>
						<td class="col-sm-4"></td>
						<td class="col-sm-1"><button v-on:click="selectDisease(d.id)" type="button" class="btn btn-primary">选择</button></td>
					</tr>
				</table>
			</div>
			<div>
				<nav aria-label="Page navigation">
					<ul class="pagination">
						<li>
							<a href="#" aria-label="Previous">
								<span aria-hidden="true">&laquo;</span>
							</a>
						</li>
						<li><a href="#">1</a></li>
						<li><a href="#">2</a></li>
						<li><a href="#">3</a></li>
						<li><a href="#">4</a></li>
						<li><a href="#">5</a></li>
						<li>
							<a href="#" aria-label="Next">
								<span aria-hidden="true">&raquo;</span>
							</a>
						</li>
					</ul>
				</nav>
			</div>
			<button id="cancel-select" class="btn" style="position: absolute;left:
			50%;transform: translate(-50%,0);">取消</button>

		</div>

	</body>

	<script src="./lib/toastr/toastr.min.js"></script>
	<script src="lib/vue/vue.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/vue/axios.min.js" type="text/javascript" charset="utf-8"></script>
	<script>
		toastr.options = {
			"closeButton": true,
			"debug": false,
			"newestOnTop": false,
			"progressBar": false,
			"positionClass": "toast-top-center",
			"preventDuplicates": false,
			"onclick": null,
			"showDuration": "300",
			"hideDuration": "1000",
			"timeOut": "2000",
			"extendedTimeOut": "1000",
			"showEasing": "swing",
			"hideEasing": "linear",
			"showMethod": "fadeIn",
			"hideMethod": "fadeOut"
		}

		// 初始化
		$(function() {
			var b = window.innerHeight;
			/* body高度 */
			$("body").css({
				height: b
			});


			//疾病表单中的取消键
			$("#cancel-select").click(function() {
				toggleDisease();
			})
		});

		//切换显示疾病弹窗
		function toggleDisease(a) {
			// a用来接收是中医还是西医
			$("#diease").slideToggle("slow");
		}

		// 提交病历
		$(".submitbtn").click(function() {
			// TODO ajax业务操作

			toastr["success"]("挂号成功!")
		})

		new Vue({
			el: "#diseasetable",
			data: {
				diseases: [{
					name: 2111,
					id: 121,
					icd: 1121,
					type: 1112,
					typeId: 1111
				}],
				selectDiseaseId: "" //已绑定，可通过id可获取
			},
			methods: {
				/* 按钮点击时更改已选疾病id */
				selectDisease: function(id) {
					this.selectDiseaseId = id;
				}
			},
			beforeMount: function() {
				var _this = this;
				axios.get("/disease/getDiseases").then(function(resp) {
					_this.diseases = resp.data
				})
			}
		})
		new Vue({
			el: "#medicalrecord",
			data: {
				medicalrecord: {
					recordNum: "",
					symptom: "",
					nowHistory: "",
					anamnesis: "",
					allergyhis: "",
					treatment: "",
					checkup: "",
					checkSugg: "",
					attention: "",
				},
				diagnoseType: "", //已绑定，可通过id可获取
				ChineseDiagnose: {
					// diseaseName: "111",
					// diagnoseDate: "2000-01-01",
					// icd: "1111"
				},
				WesternDiagnose: {
					// diseaseName: "111",
					// diagnoseDate: "2000-01-01",
					// icd: "1111"
				}
			},
			methods: {
				// 诊断数据提交
				submit: function() {
					var _this = this;
					var o = window.parent.document.getElementById("recordNum").innerHTML;
					var a = window.parent.document.getElementById("registerId").innerHTML;
					var b = _this.diagnoseType
					var c = document.getElementById("selectDiseaseId").value
					//两个axios提交
					axios.get("/medicalRecord/add",{
						params:{
							recordNum: o,
							symptom: _this.medicalrecord.symptom,
							nowHistory: _this.medicalrecord.nowHistory,
							anamnesis: _this.medicalrecord.anamnesis,
							allergyhis: _this.medicalrecord.allergyhis,
							treatment: _this.medicalrecord.treatment,
							checkup: _this.medicalrecord.checkup,
							checkSugg: _this.medicalrecord.checkSugg,
							attention: _this.medicalrecord.attention
						}
					})

					axios.get("/diagnose/doDiagnose", {
						params: {
							registerId: a,
							diagnoseType: b,
							selectDiseaseId: c
						}
					})

					// 弹出刷新成功
					toastr["success"]("提交成功!")

					//禁止更改
					$("#medicalrecord *").prop({
						disabled: true
					})

					// 调用左侧刷新
					setTimeout(function() {
						window.parent.document.getElementById("refreshbtn").click()
					}, 200)//200毫秒给vue缓冲

					//TODO 上面按钮添加事件
				},
				setDiagnoseType: function(a) {
					var Selectedstatus = window.parent.document.getElementById("Selectedstatus").innerHTML;
					if(Selectedstatus==1){
						toggleDisease(a)
						this.diagnoseType = a;
					}
				}
			},
			beforeMount: function() {
				/* 记录病历号 */
				var recordNumVal = window.parent.document.getElementById("recordNum").innerHTML;
				var rid = window.parent.document.getElementById("registerId").innerHTML;
				var _this = this;
				axios.get("/medicalRecord/getByNum", {
					params: {
						recordNum: recordNumVal
					}
				}).then(function(resp) {
					_this.medicalrecord = resp.data;
				})
				axios.get("/diagnose/ChineseDiagnose", {
					params: {
						registerId: rid
					}
				}).then(function(resp) {
					_this.ChineseDiagnose = resp.data
				})
				axios.get("/diagnose/WesternDiagnose", {
					params: {
						registerId: rid
					}
				}).then(function(resp) {
					_this.WesternDiagnose = resp.data
				})

			}
		})

		/* 已诊的话就不能再改了 */

		$(function() {
			setTimeout(function() {
				var Selectedstatus = window.parent.document.getElementById("Selectedstatus").innerHTML;
				if (Selectedstatus == 2|| Selectedstatus == 3) {
					$("#medicalrecord *").prop({
						disabled: true
					})
				}
			}, 200)
		})

		/* 为选择按钮添加事件，使数据移动 */
		$(function() {
			setTimeout(function() {
				$("#disease-page button").click(function(e) {
					
					
					
					var btn = e.target
					var a = $(btn).parent().siblings()
					var zx = $("#diagnoseType").val();
					var tr = $(
						"<tr><td class='col-sm-1'><div class='checkbox'><input type='checkbox' /></div></td><td class='col-sm-1'>" +
						a[0].innerHTML + "</td><td class='col-sm-3'>" + a[1].innerHTML +
						"</td><td class='col-sm-5'></td><td class='col-sm-2'><input type='date' /></td></tr>")
						
						// 清除内容
						var trsxiyi=$("#xiyitable").find("tr");
						var trszhongyi=$("#zhongyitable").find("tr");
						for(var i= 1;i<trsxiyi.length;i++){
							$(trsxiyi[i]).remove()
						}
						for(var i= 1;i<trszhongyi.length;i++){
							$(trszhongyi[i]).remove()
						}
					if (zx == 1) {
						$("#xiyitable").append(tr)
					} else {
						$("#zhongyitable").append(tr);
					}

					/* 关闭页面 */
					toggleDisease(a)
				})
			}, 500)// 为vue预留时间

		})

		// 跨层获取数据
		// var Selectedstatus = window.parent.document.getElementById("Selectedstatus").innerHTML;
		// var registerId = window.parent.document.getElementById("registerId").innerHTML;
		// var recordNum = window.parent.document.getElementById("recordNum").innerHTML;
		// console.log(Selectedstatus)
		// console.log(registerId)
		// console.log(recordNum)
	</script>

</html>
